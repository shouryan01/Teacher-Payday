{"version":3,"sources":["../../../../build/babel/plugins/rewrite-imports.ts"],"sourcesContent":["import { PluginObj } from 'next/dist/compiled/babel/core'\nimport { BabelType } from 'babel-plugin-tester'\n\n/*\n * https://astexplorer.net/#/gist/dd0cdbd56a701d8c9e078d20505b3980/latest\n */\n\nconst defaultImportSource = 'next/stdlib'\n\nconst specialImports: Record<string, string> = {\n  Link: 'next/link',\n  Image: 'next/image',\n  Script: 'next/script',\n\n  Document: 'next/document',\n  DocumentHead: 'next/document',\n  Html: 'next/document',\n  Main: 'next/document',\n  BlitzScript: 'next/document',\n\n  // AuthenticationError: 'next/stdlib',\n  // AuthorizationError: 'next/stdlib',\n  // CSRFTokenMismatchError: 'next/stdlib',\n  // NotFoundError: 'next/stdlib',\n  // PaginationArgumentError: 'next/stdlib',\n  // RedirectError: 'next/stdlib',\n  // formatZodError: 'next/stdlib',\n  // recursiveFormatZodErrors: 'next/stdlib',\n  // validateZodSchema: 'next/stdlib',\n  // enhancePrisma: 'next/stdlib',\n  // ErrorBoundary: 'next/stdlib',\n  // withErrorBoundary: 'next/stdlib',\n  // useErrorHandler: 'next/stdlib',\n  // withBlitzAppRoot: 'next/stdlib',\n\n  paginate: 'next/stdlib-server',\n  isLocalhost: 'next/stdlib-server',\n  invokeWithMiddleware: 'next/stdlib-server',\n  passportAuth: 'next/stdlib-server',\n  sessionMiddleware: 'next/stdlib-server',\n  simpleRolesIsAuthorized: 'next/stdlib-server',\n  getSession: 'next/stdlib-server',\n  setPublicDataForUser: 'next/stdlib-server',\n  SecurePassword: 'next/stdlib-server',\n  hash256: 'next/stdlib-server',\n  generateToken: 'next/stdlib-server',\n  resolver: 'next/stdlib-server',\n  connectMiddleware: 'next/stdlib-server',\n\n  getAntiCSRFToken: 'next/data-client',\n  useSession: 'next/data-client',\n  useAuthenticatedSession: 'next/data-client',\n  useRedirectAuthenticated: 'next/data-client',\n  useAuthorize: 'next/data-client',\n  useQuery: 'next/data-client',\n  usePaginatedQuery: 'next/data-client',\n  useInfiniteQuery: 'next/data-client',\n  useMutation: 'next/data-client',\n  queryClient: 'next/data-client',\n  getQueryKey: 'next/data-client',\n  getInfiniteQueryKey: 'next/data-client',\n  invalidateQuery: 'next/data-client',\n  setQueryData: 'next/data-client',\n  useQueryErrorResetBoundary: 'next/data-client',\n  QueryClient: 'next/data-client',\n  dehydrate: 'next/data-client',\n  invoke: 'next/data-client',\n\n  Head: 'next/head',\n\n  App: 'next/app',\n\n  dynamic: 'next/dynamic',\n  noSSR: 'next/dynamic',\n\n  getConfig: 'next/config',\n  setConfig: 'next/config',\n\n  ErrorComponent: 'next/error',\n}\n\nfunction RewriteImports(babel: BabelType): PluginObj {\n  const { types: t } = babel\n\n  return {\n    name: 'RewriteImports',\n    visitor: {\n      ImportDeclaration(path) {\n        if (\n          !looksLike(path, {\n            node: {\n              source: { value: 'blitz' },\n            },\n          })\n        ) {\n          return\n        }\n\n        path.node.source = t.stringLiteral(defaultImportSource)\n\n        const specifierIndexesToRemove: number[] = []\n        path.node.specifiers.slice().forEach((specifier, index) => {\n          if (!t.isImportSpecifier(specifier)) return\n          const importedName = t.isStringLiteral(specifier.imported)\n            ? specifier.imported.value\n            : specifier.imported.name\n          if (importedName in specialImports) {\n            path.insertAfter(\n              t.importDeclaration(\n                [specifier],\n                t.stringLiteral(specialImports[importedName])\n              )\n            )\n\n            specifierIndexesToRemove.push(index)\n          }\n        })\n        specifierIndexesToRemove.reverse().forEach((index) => {\n          path.node.specifiers.splice(index, 1)\n        })\n        if (!path.node.specifiers.length) {\n          path.remove()\n        }\n      },\n    },\n  }\n}\n\nfunction looksLike(a: any, b: any): boolean {\n  return (\n    a &&\n    b &&\n    Object.keys(b).every((bKey) => {\n      const bVal = b[bKey]\n      const aVal = a[bKey]\n      if (typeof bVal === 'function') {\n        return bVal(aVal)\n      }\n      return isPrimitive(bVal) ? bVal === aVal : looksLike(aVal, bVal)\n    })\n  )\n}\nfunction isPrimitive(val: any) {\n  return val == null || /^[sbn]/.test(typeof val)\n}\n\n// eslint-disable-next-line import/no-default-export\nexport default RewriteImports\n"],"names":[],"mappings":"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"}