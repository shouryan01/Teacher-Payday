"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = blitzRpcClient;
var _utils = require("../../utils");
/* This plugin changes the file contents to this:
 *
import { buildRpcClient } from "next/data-client";
export default buildRpcClient({
  "resolverName": "getUsers",
  "resolverType": "query",
  "routePath": "/api/rpc/getUsers"
});
 *
*/ // https://astexplorer.net/#/gist/02bab3c8f0488923346b607ed578e2f7/latest (may be out of date)
const fileExtensionRegex = /\.([a-z]+)$/;
function blitzRpcClient(babel) {
    const { types: t  } = babel;
    return {
        visitor: {
            Program: {
                enter (path, state) {
                    var ref;
                    const { filename , cwd  } = state;
                    const fileExt = ((ref = fileExtensionRegex.exec(filename)) === null || ref === void 0 ? void 0 : ref[1]) || 'unknown';
                    const relativePathFromRoot = filename.replace(cwd, '');
                    const resolverName = (0, _utils).convertPageFilePathToResolverName(relativePathFromRoot);
                    const resolverType = (0, _utils).convertPageFilePathToResolverType(relativePathFromRoot);
                    const routePath = (0, _utils).convertPageFilePathToRoutePath(relativePathFromRoot, [
                        fileExt
                    ]);
                    const importDeclaration = t.importDeclaration([
                        t.importSpecifier(t.identifier('buildRpcClient'), t.identifier('buildRpcClient')), 
                    ], t.stringLiteral('next/data-client'));
                    const exportDeclaration = t.exportDefaultDeclaration(t.callExpression(t.identifier('buildRpcClient'), [
                        t.objectExpression([
                            t.objectProperty(t.stringLiteral('resolverName'), t.stringLiteral(resolverName)),
                            t.objectProperty(t.stringLiteral('resolverType'), t.stringLiteral(resolverType)),
                            t.objectProperty(t.stringLiteral('routePath'), t.stringLiteral(routePath)), 
                        ]), 
                    ]));
                    path.node.body = [
                        importDeclaration,
                        exportDeclaration
                    ];
                }
            }
        }
    };
}

//# sourceMappingURL=blitz-rpc-client.js.map