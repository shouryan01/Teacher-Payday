{"version":3,"sources":["../../../server/lib/utils.ts"],"sourcesContent":["import findUp from 'next/dist/compiled/find-up'\nimport path from 'path'\nimport { existsSync } from 'fs-extra'\nimport { dirname } from 'path'\nimport { CONFIG_FILE } from '../../shared/lib/constants'\nimport { NextConfigComplete } from '../config-shared'\n\nexport function printAndExit(message: string, code = 1) {\n  if (code === 0) {\n    console.log(message)\n  } else {\n    console.error(message)\n  }\n\n  process.exit(code)\n}\n\nexport function getNodeOptionsWithoutInspect() {\n  const NODE_INSPECT_RE = /--inspect(-brk)?(=\\S+)?( |$)/\n  return (process.env.NODE_OPTIONS || '').replace(NODE_INSPECT_RE, '')\n}\n\nexport async function getProjectRoot(dir: string) {\n  const builtConfigPath = await findUp(CONFIG_FILE, { cwd: dir })\n\n  if (builtConfigPath) return path.dirname(builtConfigPath)\n\n  const pkgJsonPath = await findUp('package.json', { cwd: dir })\n\n  if (!pkgJsonPath) {\n    throw new Error(\n      'Unable to find project root by looking for your package.json or for ' +\n        CONFIG_FILE\n    )\n  }\n\n  return dirname(pkgJsonPath)\n}\n\nexport function getProjectRootSync() {\n  return path.dirname(getConfigSrcPath())\n}\n\nexport function getConfigSrcPath() {\n  const tsPath = path.resolve(path.join(process.cwd(), 'blitz.config.ts'))\n  if (existsSync(tsPath)) {\n    return tsPath\n  } else {\n    const jsPath = path.resolve(path.join(process.cwd(), 'blitz.config.js'))\n    return jsPath\n  }\n}\n\nfunction round(num: number, decimalPlaces: number) {\n  const p = Math.pow(10, decimalPlaces)\n  const m = num * p * (1 + Number.EPSILON)\n  return Math.round(m) / p\n}\n\n/**\n * Formats milliseconds to a string\n * If more than 1s, it'll return seconds instead\n * @example\n * prettyMs(100) // -> `100ms`\n * prettyMs(1200) // -> `1.2s`\n * @param ms\n */\nexport function prettyMs(ms: number): string {\n  if (Math.abs(ms) >= 1000) {\n    return `${round(ms / 1000, 1)}s`\n  }\n  return `${ms}ms`\n}\n\nexport function getSessionCookiePrefix(config: NextConfigComplete) {\n  const middleware = config.middleware?.filter(\n    (m) => m.config?.name === 'blitzSessionMiddleware'\n  )[0]\n  const sessionCookiePrefix = middleware?.config?.cookiePrefix || 'blitz'\n  return sessionCookiePrefix\n}\n"],"names":[],"mappings":"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"}