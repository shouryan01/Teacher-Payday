"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("lodash"),t=function(n){return Object.prototype.toString.call(n).slice(8,-1)},e=function(n){return"Undefined"===t(n)},r=function(n){return"Null"===t(n)},i=function(n){return"Object"===t(n)&&n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype},u=function(n){return"Array"===t(n)},o=function(n){return"String"===t(n)},a=function(n){return"RegExp"===t(n)},c=function(n){return"Map"===t(n)},f=function(n){return"Set"===t(n)},s=function(n){return"Symbol"===t(n)},l=function(n){return"Date"===t(n)&&!isNaN(n)},v=function(n){return"Number"===t(n)&&isNaN(n)},g=function(n){return function(n){return"Boolean"===t(n)}(n)||r(n)||e(n)||function(n){return"Number"===t(n)&&!isNaN(n)}(n)||o(n)||s(n)},p=function(n){return"BigInt"===t(n)},h=function(n,t){for(var e=n.keys();t>0;)e.next(),t--;return e.next().value},d=function(n,t,e){if(0===t.length)return e(n);for(var r=n,o=0;o<t.length-1;o++){var a=t[o];if(u(r))r=r[+a];else if(i(r))r=r[a];else if(f(r))r=h(r,+a);else if(c(r)){if(o===t.length-2)break;var s=0==+t[o+1]?"key":"value",l=h(r,+a);switch(s){case"key":r=l;break;case"value":r=r.get(l)}o++}}var v=t[t.length-1];if((u(r)||i(r))&&(r[v]=e(r[v])),f(r)){var g=h(r,+v),p=e(g);g!==p&&(r.delete(g),r.add(p))}if(c(r)){var d=h(r,+t[t.length-2]);switch(0==+v?"key":"value"){case"key":var y=e(d);r.set(y,r.get(d)),y!==d&&r.delete(d);break;case"value":r.set(d,e(r.get(d)))}}return n},y=function(){function n(){this.keyToValue=new Map,this.valueToKey=new Map}var t=n.prototype;return t.set=function(n,t){this.keyToValue.set(n,t),this.valueToKey.set(t,n)},t.deleteByValue=function(n){var t=this;this.valueToKey.delete(n),this.keyToValue.forEach((function(e,r){n===e&&t.keyToValue.delete(r)}))},t.getByKey=function(n){return this.keyToValue.get(n)},t.getByValue=function(n){return this.valueToKey.get(n)},t.clear=function(){this.keyToValue.clear(),this.valueToKey.clear()},n}(),m=function(){function n(n){this.generateIdentifier=n,this.kv=new y}var t=n.prototype;return t.register=function(n,t){if(!this.kv.getByValue(n)){if(t||(t=this.generateIdentifier(n)),this.kv.getByKey(t))throw new Error("Ambiguous class, provide a unique identifier.");this.kv.set(t,n)}},t.unregister=function(n){this.kv.deleteByValue(n)},t.clear=function(){this.kv.clear()},t.getIdentifier=function(n){return this.kv.getByValue(n)},t.getValue=function(n){return this.kv.getByKey(n)},n}(),b=new m((function(n){return n.name})),w=new m((function(n){var t;return null!==(t=n.description)&&void 0!==t?t:""})),I=["undefined","number","bigint"].concat(["map","regexp","set","Date"]),k=function(t){return Array.isArray(t)?"string"==typeof t[1]:n.includes(I,t)};function j(n,t,e,r){return{isApplicable:n,annotation:t,transform:e,untransform:r}}var E=[j(e,"undefined",(function(){return null}),(function(){})),j(p,"bigint",(function(n){return n.toString()}),(function(n){return"undefined"!=typeof BigInt?BigInt(n):(console.error("Please add a BigInt polyfill."),n)})),j(l,"Date",(function(n){return n.toISOString()}),(function(n){return new Date(n)})),j(a,"regexp",(function(n){return""+n}),(function(n){var t=n.slice(1,n.lastIndexOf("/")),e=n.slice(n.lastIndexOf("/")+1);return new RegExp(t,e)})),j(f,"set",(function(t){return n.entries(t).map((function(n){return n[0]}))}),(function(n){return new Set(n)})),j(c,"map",(function(t){return n.entries(t)}),(function(n){return new Map(n)})),j((function(n){return v(n)||Infinity===(t=n)||-Infinity===t;var t}),"number",(function(n){return v(n)?"NaN":n>0?"Infinity":"-Infinity"}),Number)];function O(n,t,e,r){return{isApplicable:n,annotation:t,transform:e,untransform:r}}var N=O((function(n){return!!s(n)&&!!w.getIdentifier(n)}),(function(n){return["symbol",w.getIdentifier(n)]}),(function(n){return n.description}),(function(n,t){var e=w.getValue(t[1]);if(!e)throw new Error("Trying to deserialize unknown symbol");return e})),S=O((function(n){return!!(null==n?void 0:n.constructor)&&!!b.getIdentifier(n.constructor)}),(function(n){return["class",b.getIdentifier(n.constructor)]}),(function(n){return n}),(function(n,t){var e=b.getValue(t[1]);if(!e)throw new Error("Trying to deserialize unknown class");return Object.assign(Object.create(e.prototype),n)})),x=[S,N],T=n.fromPairs(E.map((function(n){return[n.annotation,n]})));function A(){return(A=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r])}return n}).apply(this,arguments)}var V,B=function(n){return n.replace(/\./g,"\\.")},R=function(n){return n.map(String).map(B).join(".")},z=function(n){for(var t=[],e="",r=0;r<n.length;r++){var i=n.charAt(r);"\\"===i&&"."===n.charAt(r+1)?(e+=".",r++):"."===i?(t.push(e),e=""):e+=i}return t.push(e),t};function M(t,e){return!!u(t)&&(1===t.length?e(t[0]):2===t.length&&e(t[0])&&n.every(t[1],(function(n){return M(n,e)})))}!function(t){function o(t,r,i){var u;if(0===r.length)return 1===t.length?[i]:[i,t[1]];if(1===t.length)return[t[0],(u={},u[R(r)]=[i],u)];var a,c=t[0],f=t[1],s=Object.keys(f),l=n.find(s,(function(n){return!((t=z(n)).length>(e=r).length)&&t.every((function(n,t){return n===e[t]}));var t,e}));if(e(l))return[c,A({},f,(a={},a[R(r)]=[i],a))];var v,g=r.slice(z(l).length);return[c,A({},f,(v={},v[l]=o(f[l],g,i),v))]}function a(t,e,r){if(void 0===r&&(r=[]),1===t.length)e(t[0],r);else{var i=t[0];n.forEach(t[1],(function(n,t){a(n,e,[].concat(r,z(t)))})),e(i,r)}}function c(n,t){a(n,(function(n,e){if(r(n)){if(0===e.length)return;throw new Error("Illegal State")}t(n,e)}))}t.create=function(n){return[n]},t.get=function n(t,e){if(0===e.length)return[t[0],!0];if(1===t.length)return[null,!1];var r=e[0],i=e.slice(1);return n(t[1][r],i)},t.append=o,t.appendPath=function(n,t){return o(n,t.slice(0,t.length-1),t[t.length-1])},t.traverse=a,t.traverseWhileIgnoringNullRoot=c,t.traversePaths=function(n,t){c(n,(function(n,e){return t([].concat(e,[n]))}))},t.isMinimizedTree=function(t,r){return!!e(t)||(i(t)?n.every(t,(function(n){return M(n,r)})):M(t,r))},t.collapseRoot=function(n){return r(n[0])?1===n.length?void 0:n[1]:n},t.expandRoot=function(n){return u(n)?n:e(n)?[null]:[null,n]}}(V||(V={}));var P=function(){function n(){this.tree=V.create(null)}var t=n.prototype;return t.add=function(n,t){this.tree=V.append(this.tree,n.map(String),t)},t.create=function(){return V.collapseRoot(this.tree)},n}(),K=function(){function n(){this.objectIdentities=new Map}var t=n.prototype;return t.register=function(n,t){var e,r=null!==(e=this.objectIdentities.get(n))&&void 0!==e?e:[];r.push(t),this.objectIdentities.set(n,r)},t.create=function(){var n=V.create(null);return this.objectIdentities.forEach((function(t){if(!(t.length<=1)){var e=t.map((function(n){return n.map(String)})).sort((function(n,t){return n.length-t.length})),r=e[0],i=e.slice(1),u=V.create(null);i.forEach((function(n){u=V.appendPath(u,n)}));var o=V.collapseRoot(u);if(!o)throw new Error("Illegal State");n=V.append(n,r,o)}})),V.collapseRoot(n)},n}(),q=function(){function n(){this.valueAnnotations=new P,this.objectIdentities=new K}return n.prototype.create=function(){var n={},t=this.valueAnnotations.create();t&&(n.values=t);var e=this.objectIdentities.create();return e&&(n.referentialEqualities=e),n},n}(),D=function(t){var e,r,o,a,s=(r=new q,o=r.valueAnnotations,a=r.objectIdentities,{getAnnotations:function(){return r.create()},annotator:function(t){var e=t.path,r=t.node;g(r)||a.register(r,e);var i=function(t){var e=n.find(E,(function(n){return n.isApplicable(t)}));if(e)return{value:e.transform(t),type:e.annotation};var r=n.find(x,(function(n){return n.isApplicable(t)}));return r?{value:r.transform(t),type:r.annotation(t)}:void 0}(r);return i?(o.add(e,i.type),i.value):r}}),l=s.getAnnotations,v=function t(e,r,o,a){return void 0===o&&(o=[]),void 0===a&&(a=[]),function(n){return i(n)||u(n)||c(n)||f(n)}(e)?(r({isLeaf:!1,path:o,node:e}),n.includes(a,e)?null:(g(e)||(a=[].concat(a,[e])),u(e)?n.values(e).map((function(n,e){return t(n,r,[].concat(o,[e]),a)})):f(e)?n.entries(e).map((function(n,e){return t(n[0],r,[].concat(o,[e]),a)})):c(e)?n.entries(e).map((function(n,e){var i=n[1];return[t(n[0],r,[].concat(o,[e,0]),a),t(i,r,[].concat(o,[e,1]),a)]})):i(e)?n.mapValues(e,(function(n,e){return t(n,r,[].concat(o,[e]),a)})):void 0)):r({isLeaf:!0,node:e,path:o})}(t,s.annotator),p=l();return{json:v,meta:(e=p,i(e)&&0===Object.keys(e).length?void 0:p)}},J=function(n){if(!("json"in(t=n))||!e(t.meta)&&!function(n){try{return!(n.values&&!V.isMinimizedTree(n.values,k)||n.referentialEqualities&&!V.isMinimizedTree(n.referentialEqualities,(function(n){return V.isMinimizedTree(n,o)})))}catch(n){return!1}}(t.meta))throw new Error("Not a valid SuperJSON payload.");var t,r,i,a=n.meta,c=n.json;return a?(r=c,(i=a).values&&V.traverseWhileIgnoringNullRoot(V.expandRoot(i.values),(function(n,t){r=d(r,t,(function(t){return function(n,t){if(!u(t)){var e=T[t];if(!e)throw new Error("Unknown transformation: "+t);return e.untransform(n)}switch(t[0]){case"symbol":return N.untransform(n,t);case"class":return S.untransform(n,t);default:throw new Error("Unknown transformation: "+t)}}(t,n)}))})),i.referentialEqualities&&V.traverseWhileIgnoringNullRoot(V.expandRoot(i.referentialEqualities),(function(n,t){var e=function(n,t){return t.forEach((function(t){n=n[t]})),n}(r,t);V.traversePaths(V.expandRoot(n),(function(n){r=d(r,n,(function(){return e}))}))})),r):c},U=function(n){return J(JSON.parse(n))};exports.default={stringify:function(n){return JSON.stringify(D(n))},parse:U,serialize:D,deserialize:J,registerClass:function(n,t){return b.register(n,t)},unregisterClass:function(n){return b.unregister(n)},registerSymbol:function(n,t){return w.register(n,t)},unregisterSymbol:function(n){return w.unregister(n)}},exports.deserialize=J,exports.parse=U,exports.serialize=D;
//# sourceMappingURL=superjson.cjs.production.min.js.map
